<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wifto ~ Complete Educational Platform</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;900&family=Segoe+UI&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary-bg: linear-gradient(135deg, #6a11cb, #1a499b);
      --secondary-bg: linear-gradient(135deg, #f0f4f8, #d0e8f2, #c8f0dc);
      --accent-color: #ff6f00;
      --success-color: #388e3c;
      --primary-blue: #1976d2;
      --dark-blue: #0d47a1;
      --text-color: #333;
      --card-bg: #fff;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      --admin-color: #e91e63;
    }

    [data-theme="dark"] {
      --primary-bg: linear-gradient(135deg, #1a1a1a, #2d1b69);
      --secondary-bg: linear-gradient(135deg, #1e1e1e, #2a2a2a, #1a1a1a);
      --accent-color: #ffab40;
      --success-color: #66bb6a;
      --primary-blue: #42a5f5;
      --dark-blue: #1e88e5;
      --text-color: #e0e0e0;
      --card-bg: #2a2a2a;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    body {
      background: var(--primary-bg);
      min-height: 100vh;
      color: var(--text-color);
      transition: all 0.3s ease;
      position: relative;
      overflow-x: hidden;
    }

    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }

    .hidden {
      display: none !important;
    }

    /* Welcome Page */
    .welcome-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      text-align: center;
      color: white;
      position: relative;
    }

    .welcome-content {
      animation: fadeIn 2s ease-in-out;
      max-width: 600px;
    }

    .welcome-content h1 {
      font-size: 4rem;
      margin-bottom: 20px;
      background: linear-gradient(45deg, #fff, #ffab40);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-content p {
      font-size: 1.5rem;
      margin-bottom: 30px;
      opacity: 0.9;
    }

    .welcome-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .welcome-btn {
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, #fff, #f0f0f0);
      color: #2575fc;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .welcome-btn:hover {
      transform: scale(1.1) translateY(-3px);
      box-shadow: 0 10px 25px rgba(255, 255, 255, 0.3);
    }

    .welcome-btn.admin {
      background: linear-gradient(135deg, #e91e63, #f06292);
      color: white;
    }

    /* User Panel */
    .user-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      padding: 15px;
      border-radius: 15px;
      box-shadow: var(--shadow);
      z-index: 1000;
      min-width: 200px;
      transition: all 0.3s ease;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent-color), var(--success-color));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .user-avatar.admin {
      background: linear-gradient(135deg, var(--admin-color), #f06292);
    }

    .theme-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .theme-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .theme-btn.active {
      background: var(--primary-blue);
      color: white;
    }

    .session-info {
      font-size: 11px;
      opacity: 0.7;
      margin-bottom: 10px;
    }

    .logout-btn {
      width: 100%;
      padding: 8px;
      background: #e53935;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: #b71c1c;
      transform: translateY(-2px);
    }

    /* Login Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .login-modal {
      background: var(--card-bg);
      padding: 40px;
      border-radius: 20px;
      max-width: 400px;
      width: 90%;
      box-shadow: var(--shadow);
      text-align: center;
      animation: modalSlideIn 0.5s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(-50px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .login-modal h2 {
      margin-bottom: 20px;
      color: var(--dark-blue);
    }

    .login-modal input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: var(--card-bg);
      color: var(--text-color);
    }

    .login-modal button {
      background: var(--primary-blue);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
      width: 100%;
      transition: all 0.3s ease;
    }

    .login-modal button:hover {
      background: var(--dark-blue);
      transform: translateY(-2px);
    }

    .switch {
      margin-top: 15px;
      font-size: 0.9rem;
      color: var(--primary-blue);
      cursor: pointer;
      text-decoration: underline;
    }

    /* Main Container */
    .main-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Navigation */
    .nav-bar {
      background: var(--card-bg);
      padding: 15px 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .nav-btn {
      padding: 10px 20px;
      background: var(--primary-blue);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
    }

    .nav-btn:hover, .nav-btn.active {
      background: var(--dark-blue);
      transform: translateY(-2px);
    }

    .nav-btn.admin {
      background: var(--admin-color);
    }

    .nav-btn.admin:hover {
      background: #c2185b;
    }

    .section {
      background: var(--card-bg);
      margin: 30px 0;
      padding: 30px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      animation: fadeInUp 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 3rem;
      text-align: center;
      line-height: 1.3;
      margin-bottom: 30px;
      color: var(--text-color);
    }

    h1 .wifto {
      color: var(--accent-color);
      font-weight: 900;
      text-decoration: underline;
    }

    h1 .highlight {
      color: var(--success-color);
      font-weight: 700;
    }

    h2 {
      text-align: center;
      color: var(--dark-blue);
      margin: 30px 0 15px 0;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
    }

    /* News Feed Styles */
    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .news-card {
      background: var(--card-bg);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .news-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }

    .news-header {
      background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
      color: white;
      padding: 15px;
      font-weight: bold;
      font-size: 1.1rem;
    }

    .news-content {
      padding: 20px;
    }

    .news-summary {
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 15px;
      color: var(--text-color);
    }

    .news-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px 20px 20px;
    }

    .news-actions {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      padding: 5px 12px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .like-btn {
      background: #e91e63;
      color: white;
    }

    .like-btn:hover {
      background: #c2185b;
    }

    .like-btn.liked {
      background: #4caf50;
    }

    .share-btn {
      background: #2196f3;
      color: white;
    }

    .share-btn:hover {
      background: #1976d2;
    }

    .news-tags {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .news-tag {
      background: var(--accent-color);
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
    }

    /* Quiz Styles */
    .quiz-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .question {
      margin: 20px 0;
      font-size: 18px;
      font-weight: bold;
      animation: fadeInUp 0.8s ease;
    }

    .options label {
      display: block;
      padding: 12px;
      border: 2px solid var(--primary-blue);
      border-radius: 12px;
      margin: 8px 0;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--card-bg);
      color: var(--text-color);
    }

    .options label:hover {
      background: var(--primary-blue);
      color: white;
      transform: scale(1.02);
    }

    .options label.correct {
      background: #4caf50;
      color: white;
      border-color: #4caf50;
    }

    .options label.wrong {
      background: #f44336;
      color: white;
      border-color: #f44336;
    }

    .options label.selected {
      background: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }

    .feedback {
      background: var(--card-bg);
      border-left: 5px solid var(--primary-blue);
      padding: 15px;
      margin: 15px 0;
      border-radius: 10px;
      animation: fadeInUp 0.8s ease;
    }

    .score-box {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      border: 3px solid var(--success-color);
    }

    .analysis-card {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2);
      border: 2px solid var(--accent-color);
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
    }

    .weakness-analysis {
      background: linear-gradient(135deg, #ffebee, #ffcdd2);
      border: 2px solid #e53935;
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
    }

    /* Chatbot Styles */
    .chatbot-container {
      max-width: 800px;
      margin: 0 auto;
      height: 500px;
      border: 2px solid var(--primary-blue);
      border-radius: 15px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      background: var(--primary-blue);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: bold;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: var(--card-bg);
    }

    .message {
      margin: 10px 0;
      padding: 10px 15px;
      border-radius: 15px;
      max-width: 80%;
      animation: fadeInUp 0.5s ease;
    }

    .message.user {
      background: var(--primary-blue);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 5px;
    }

    .message.bot {
      background: #f0f0f0;
      color: var(--text-color);
      border-bottom-left-radius: 5px;
    }

    .chat-input-container {
      display: flex;
      padding: 15px;
      background: var(--card-bg);
      border-top: 1px solid #eee;
    }

    .chat-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 25px;
      outline: none;
      background: var(--card-bg);
      color: var(--text-color);
    }

    .chat-send {
      background: var(--primary-blue);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      margin-left: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .chat-send:hover {
      background: var(--dark-blue);
      transform: scale(1.1);
    }

    /* Admin Panel Styles */
    .admin-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .admin-card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 15px;
      box-shadow: var(--shadow);
      border-left: 5px solid var(--admin-color);
    }

    .admin-card h3 {
      color: var(--admin-color);
      margin-bottom: 15px;
      font-family: 'Poppins', sans-serif;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
      color: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: var(--shadow);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    /* Utility Classes */
    .button-group {
      text-align: center;
      margin-top: 20px;
    }

    .button-group button {
      background: var(--primary-blue);
      color: white;
      padding: 15px 25px;
      margin: 10px;
      border: none;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .button-group button:hover {
      background: var(--dark-blue);
      transform: translateY(-3px);
    }

    .search-bar {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .search-bar input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 25px;
      background: var(--card-bg);
      color: var(--text-color);
      min-width: 200px;
    }

    .search-bar button {
      padding: 12px 20px;
      border: none;
      background: var(--success-color);
      color: white;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .search-bar button:hover {
      background: #2e7d32;
      transform: translateY(-2px);
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 { font-size: 2rem; }
      .user-panel {
        position: relative;
        top: 0;
        right: 0;
        margin: 20px auto;
        max-width: 300px;
      }
      .main-container { padding: 10px; }
      .welcome-content h1 { font-size: 2.5rem; }
      .welcome-buttons { flex-direction: column; align-items: center; }
      .nav-bar { justify-content: center; }
      .news-grid { grid-template-columns: 1fr; }
      .chatbot-container { height: 400px; }
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: var(--primary-blue);
      font-size: 1.1rem;
    }

    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      border-left: 4px solid #c62828;
    }
  </style>
</head>
<body data-theme="light">
  <div class="stars" id="starsContainer"></div>

  <!-- Welcome Page -->
  <div id="welcomePage" class="welcome-container">
    <div class="welcome-content">
      <h1>Welcome to Wifto</h1>
      <p>Your ultimate educational platform with gamified learning üéâ</p>
      <div class="welcome-buttons">
        <button class="welcome-btn" id="loginBtn">üöÄ Get Started</button>
        <button class="welcome-btn" id="guestBtn">üëÅÔ∏è Explore as Guest</button>
        <button class="welcome-btn admin" id="adminBtn">üëë Admin Login</button>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal-overlay hidden">
    <div class="login-modal">
      <h2 id="loginTitle">Welcome Back!</h2>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button id="authButton">Login</button>
      <div class="switch" id="authSwitch">Don't have an account? Sign up</div>
    </div>
  </div>

  <!-- User Panel -->
  <div id="userPanel" class="user-panel hidden">
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">U</div>
      <div>
        <div id="userName">Guest</div>
        <div class="session-info" id="sessionInfo">Session: 0m</div>
      </div>
    </div>
    <div class="theme-controls">
      <button class="theme-btn active" id="lightTheme">‚òÄÔ∏è</button>
      <button class="theme-btn" id="darkTheme">üåô</button>
    </div>
    <div class="session-info" id="loginTime">Login: --</div>
    <button class="logout-btn" id="logoutButton">Logout</button>
  </div>

  <!-- Main App -->
  <div id="mainApp" class="main-container hidden">
    <!-- Navigation -->
    <div class="nav-bar" id="navBar">
      <button class="nav-btn active" id="homeNav">üè† Home</button>
      <button class="nav-btn" id="quizNav">üß† Quiz</button>
      <button class="nav-btn" id="chatNav">üí¨ AI Chat</button>
      <button class="nav-btn" id="searchNav">üîç Search</button>
    </div>

    <!-- Admin Navigation (hidden by default) -->
    <div class="nav-bar hidden" id="adminNavBar">
      <button class="nav-btn admin active" id="adminDashNav">üìä Dashboard</button>
      <button class="nav-btn admin" id="adminUsersNav">üë• Users</button>
      <button class="nav-btn admin" id="adminContentNav">üìù Content</button>
      <button class="nav-btn admin" id="adminSettingsNav">‚öôÔ∏è Settings</button>
    </div>

    <!-- Home Section -->
    <div id="homeSection" class="section">
      <h2>üåç Latest in Science, Technology & Environment</h2>
      <div class="search-bar">
        <input type="text" id="newsSearch" placeholder="Search news topics..." />
        <button id="newsSearchBtn">üîç Search News</button>
        <button id="refreshNewsBtn">üîÑ Refresh</button>
      </div>
      <div id="newsContainer" class="news-grid">
        <div class="loading">Loading latest news... üì∞</div>
      </div>
    </div>

    <!-- Quiz Section -->
    <div id="quizSection" class="section hidden">
      <h2>üéØ Interactive Knowledge Quiz</h2>
      <div class="quiz-container">
        <div id="quizStart">
          <p style="text-align: center; margin-bottom: 20px;">Test your knowledge with our adaptive quiz system!</p>
          <div class="button-group">
            <button id="startQuizBtn">üéØ Start New Quiz</button>
            <button id="historyBtn">üìä View History</button>
            <button id="customQuizBtn">‚öôÔ∏è Custom Quiz</button>
          </div>
        </div>
        <div id="quizContent" style="display: none;"></div>
      </div>
    </div>

    <!-- AI Chat Section -->
    <div id="chatSection" class="section hidden">
      <h2>ü§ñ AI Educational Assistant</h2>
      <div class="chatbot-container">
        <div class="chat-header">
          <div>WiftoBot - Your Learning Companion üéì</div>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="message bot">
            Hello! I'm WiftoBot, your educational companion! üòä I'm here to help you learn about science, technology, and the environment. Ask me anything, and I'll do my best to explain it in an engaging way! What would you like to explore today?
          </div>
        </div>
        <div class="chat-input-container">
          <input type="text" class="chat-input" id="chatInput" placeholder="Ask me about science, technology, environment..." />
          <button class="chat-send" id="chatSend">‚û§</button>
        </div>
      </div>
    </div>

    <!-- Search Section -->
    <div id="searchSection" class="section hidden">
      <h2>üîç Knowledge Explorer</h2>
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search for educational content..." />
        <button id="searchBtn">üîç Search</button>
        <button id="advancedSearchBtn">üî¨ Advanced Search</button>
      </div>
      <div id="searchResults"></div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashSection" class="section hidden">
      <h2>üëë Admin Dashboard</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalUsers">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalQuizzes">0</div>
          <div class="stat-label">Quizzes Taken</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalContent">0</div>
          <div class="stat-label">Content Items</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="avgScore">0%</div>
          <div class="stat-label">Average Score</div>
        </div>
      </div>
      <div class="admin-dashboard">
        <div class="admin-card">
          <h3>Recent Activity</h3>
          <div id="recentActivity"></div>
        </div>
        <div class="admin-card">
          <h3>Top Performers</h3>
          <div id="topPerformers"></div>
        </div>
        <div class="admin-card">
          <h3>System Status</h3>
          <div id="systemStatus">
            <p>‚úÖ All systems operational</p>
            <p>üìä Database: Connected</p>
            <p>üîÑ Last updated: <span id="lastUpdate"></span></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Users Section -->
    <div id="adminUsersSection" class="section hidden">
      <h2>üë• User Management</h2>
      <div id="usersList"></div>
    </div>

    <!-- Admin Content Section -->
    <div id="adminContentSection" class="section hidden">
      <h2>üìù Content Management</h2>
      <div class="button-group">
        <button id="addNewsBtn">‚ûï Add News</button>
        <button id="manageQuizBtn">üìù Manage Quizzes</button>
        <button id="analyticsBtn">üìä Analytics</button>
      </div>
      <div id="contentManagement"></div>
    </div>

    <!-- Admin Settings Section -->
    <div id="adminSettingsSection" class="section hidden">
      <h2>‚öôÔ∏è System Settings</h2>
      <div class="admin-card">
        <h3>Platform Configuration</h3>
        <div class="button-group">
          <button id="resetDataBtn">üóëÔ∏è Reset All Data</button>
          <button id="backupDataBtn">üíæ Backup Data</button>
          <button id="exportDataBtn">üì§ Export Analytics</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentUser = null;
    let sessionStartTime = null;
    let isLogin = true;
    let isAdmin = false;
    let userFiles = [];
    let quizQuestions = [];
    let userResponses = {};
    let currentQ = 0;
    let newsData = [];
    let chatHistory = [];

    // Enhanced quiz questions with categories
    const questionBank = [
      {q:"Which is the largest desert in India?", options:["Thar","Sambhar","Rann of Kutch","Kutch"], answer:"Thar", category:"Geography", difficulty:"Easy"},
      {q:"Which is the national bird of India?", options:["Peacock","Sparrow","Eagle","Kingfisher"], answer:"Peacock", category:"Biology", difficulty:"Easy"},
      {q:"Which river is known as the 'Ganga of South India'?", options:["Godavari","Krishna","Cauvery","Narmada"], answer:"Godavari", category:"Geography", difficulty:"Medium"},
      {q:"Which gas is most abundant in Earth's atmosphere?", options:["Oxygen","Nitrogen","Carbon Dioxide","Argon"], answer:"Nitrogen", category:"Science", difficulty:"Medium"},
      {q:"What is the chemical symbol for gold?", options:["Go","Gd","Au","Ag"], answer:"Au", category:"Chemistry", difficulty:"Medium"},
      {q:"Which planet is closest to the Sun?", options:["Venus","Mercury","Mars","Earth"], answer:"Mercury", category:"Astronomy", difficulty:"Easy"},
      {q:"What is the largest organ in the human body?", options:["Brain","Liver","Skin","Heart"], answer:"Skin", category:"Biology", difficulty:"Medium"},
      {q:"Which renewable energy source uses turbines?", options:["Solar","Hydro","Wind","Geothermal"], answer:"Wind", category:"Environment", difficulty:"Easy"},
      {q:"What is the pH value of pure water?", options:["6","7","8","9"], answer:"7", category:"Chemistry", difficulty:"Medium"},
      {q:"Which layer of Earth's atmosphere contains the ozone layer?", options:["Troposphere","Stratosphere","Mesosphere","Thermosphere"], answer:"Stratosphere", category:"Environment", difficulty:"Hard"},
      {q:"What is the smallest unit of matter?", options:["Molecule","Atom","Electron","Neutron"], answer:"Atom", category:"Physics", difficulty:"Medium"},
      {q:"Which biome has the highest biodiversity?", options:["Temperate Forest","Grasslands","Rainforest","Desert"], answer:"Rainforest", category:"Environment", difficulty:"Medium"},
      {q:"What type of energy does the sun primarily emit?", options:["Nuclear","Chemical","Electromagnetic","Mechanical"], answer:"Electromagnetic", category:"Physics", difficulty:"Hard"},
      {q:"Which programming language is known for AI development?", options:["HTML","Python","CSS","SQL"], answer:"Python", category:"Technology", difficulty:"Medium"},
      {q:"What is the main cause of ocean acidification?", options:["Oil spills","Plastic pollution","CO2 absorption","Industrial waste"], answer:"CO2 absorption", category:"Environment", difficulty:"Hard"},
      {q:"Which element has the atomic number 1?", options:["Helium","Hydrogen","Lithium","Carbon"], answer:"Hydrogen", category:"Chemistry", difficulty:"Easy"},
      {q:"What is the speed of light in vacuum?", options:["3√ó10‚Å∏ m/s","3√ó10‚Åπ m/s","3√ó10‚Å∑ m/s","3√ó10¬π‚Å∞ m/s"], answer:"3√ó10‚Å∏ m/s", category:"Physics", difficulty:"Hard"},
      {q:"Which technology enables wireless communication?", options:["Bluetooth","Fiber optic","USB","HDMI"], answer:"Bluetooth", category:"Technology", difficulty:"Easy"},
      {q:"What is the main greenhouse gas?", options:["Oxygen","Nitrogen","Carbon Dioxide","Methane"], answer:"Carbon Dioxide", category:"Environment", difficulty:"Medium"},
      {q:"Which organ produces insulin?", options:["Liver","Kidney","Pancreas","Stomach"], answer:"Pancreas", category:"Biology", difficulty:"Medium"}
    ];

    // Sample news data
    const sampleNewsData = [
      {
        id: 1,
        title: "Breakthrough in Quantum Computing Achieved",
        summary: "Scientists have developed a new quantum processor that can solve complex problems 1000x faster than traditional computers. This breakthrough could revolutionize drug discovery, climate modeling, and artificial intelligence.",
        category: "Technology",
        tags: ["quantum", "computing", "AI"],
        likes: 42,
        shares: 15,
        timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000),
        source: "Tech Research Institute"
      },
      {
        id: 2,
        title: "New Species of Deep Sea Coral Discovered",
        summary: "Marine biologists have discovered a new species of bioluminescent coral in the Mariana Trench. The coral appears to thrive in extreme conditions and may hold keys to understanding climate resilience.",
        category: "Environment",
        tags: ["marine biology", "coral", "ocean"],
        likes: 38,
        shares: 22,
        timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000),
        source: "Ocean Research Foundation"
      },
      {
        id: 3,
        title: "Solar Panel Efficiency Reaches 47% Milestone",
        summary: "A new perovskite-silicon tandem solar cell has achieved record efficiency of 47%. This technology could make solar energy significantly more cost-effective and accelerate the transition to renewable energy.",
        category: "Environment",
        tags: ["solar", "renewable energy", "efficiency"],
        likes: 65,
        shares: 33,
        timestamp: new Date(Date.now() - 8 * 60 * 60 * 1000),
        source: "Green Energy Labs"
      },
      {
        id: 4,
        title: "AI Model Predicts Protein Structures with 99% Accuracy",
        summary: "Researchers have developed an AI system that can predict protein folding patterns with unprecedented accuracy. This breakthrough could accelerate drug development and help understand genetic diseases.",
        category: "Science",
        tags: ["AI", "protein", "medicine"],
        likes: 51,
        shares: 28,
        timestamp: new Date(Date.now() - 12 * 60 * 60 * 1000),
        source: "BioTech Institute"
      },
      {
        id: 5,
        title: "Plastic-Eating Enzyme Shows Promise for Ocean Cleanup",
        summary: "Scientists have engineered an enzyme that can break down plastic waste 6 times faster than previous versions. Field tests in the Pacific Garbage Patch show promising results for large-scale deployment.",
        category: "Environment",
        tags: ["plastic", "ocean", "enzyme"],
        likes: 89,
        shares: 45,
        timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000),
        source: "Environmental Solutions Lab"
      },
      {
        id: 6,
        title: "Gene Therapy Restores Hearing in Clinical Trial",
        summary: "A groundbreaking gene therapy treatment has successfully restored hearing in patients with genetic deafness. The one-time treatment shows lasting results with minimal side effects.",
        category: "Science",
        tags: ["gene therapy", "medicine", "hearing"],
        likes: 73,
        shares: 31,
        timestamp: new Date(Date.now() - 18 * 60 * 60 * 1000),
        source: "Medical Research Center"
      }
    ];

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      createStars();
      setupEventListeners();
      checkExistingSession();
      initializeNewsData();
      setInterval(updateDashboardStats, 30000); // Update stats every 30 seconds
    });

    // Create stars background
    function createStars() {
      const starsContainer = document.getElementById('starsContainer');
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        starsContainer.appendChild(star);
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Welcome page
      document.getElementById('loginBtn').onclick = showLoginModal;
      document.getElementById('guestBtn').onclick = showGuestMode;
      document.getElementById('adminBtn').onclick = showAdminLogin;
      
      // Auth
      document.getElementById('authButton').onclick = handleAuth;
      document.getElementById('authSwitch').onclick = toggleAuth;
      document.getElementById('logoutButton').onclick = logout;
      
      // Theme
      document.getElementById('lightTheme').onclick = () => setTheme('light');
      document.getElementById('darkTheme').onclick = () => setTheme('dark');
      
      // Navigation
      document.getElementById('homeNav').onclick = () => showMainSection('home');
      document.getElementById('quizNav').onclick = () => showMainSection('quiz');
      document.getElementById('chatNav').onclick = () => showMainSection('chat');
      document.getElementById('searchNav').onclick = () => showMainSection('search');
      
      // Admin navigation
      document.getElementById('adminDashNav').onclick = () => showAdminSection('adminDash');
      document.getElementById('adminUsersNav').onclick = () => showAdminSection('adminUsers');
      document.getElementById('adminContentNav').onclick = () => showAdminSection('adminContent');
      document.getElementById('adminSettingsNav').onclick = () => showAdminSection('adminSettings');
      
      // Quiz
      document.getElementById('startQuizBtn').onclick = startQuiz;
      document.getElementById('historyBtn').onclick = viewQuizHistory;
      document.getElementById('customQuizBtn').onclick = showCustomQuiz;
      
      // Chat
      document.getElementById('chatSend').onclick = sendChatMessage;
      document.getElementById('chatInput').onkeypress = function(e) {
        if (e.key === 'Enter') sendChatMessage();
      };
      
      // News
      document.getElementById('newsSearchBtn').onclick = searchNews;
      document.getElementById('refreshNewsBtn').onclick = refreshNews;
      
      // Search
      document.getElementById('searchBtn').onclick = performSearch;
      document.getElementById('advancedSearchBtn').onclick = showAdvancedSearch;
      
      // Admin functions
      document.getElementById('resetDataBtn').onclick = resetAllData;
      document.getElementById('backupDataBtn').onclick = backupData;
      document.getElementById('exportDataBtn').onclick = exportAnalytics;
      document.getElementById('addNewsBtn').onclick = addCustomNews;
    }

    // Check existing session
    function checkExistingSession() {
      const savedUser = JSON.parse(localStorage.getItem('currentUserSession'));
      if (savedUser && savedUser.username) {
        currentUser = savedUser.username;
        sessionStartTime = savedUser.loginTime;
        isAdmin = savedUser.isAdmin || false;
        showMainApp();
      }
    }

    // Show login modal
    function showLoginModal() {
      isAdmin = false;
      document.getElementById('loginTitle').textContent = 'Welcome Back!';
      document.getElementById('loginModal').classList.remove('hidden');
    }

    // Show admin login
    function showAdminLogin() {
      isAdmin = true;
      document.getElementById('loginTitle').textContent = 'Admin Access';
      document.getElementById('username').placeholder = 'Admin ID';
      document.getElementById('password').placeholder = 'Admin Password';
      document.getElementById('loginModal').classList.remove('hidden');
    }

    // Show guest mode
    function showGuestMode() {
      currentUser = 'Guest';
      sessionStartTime = new Date().toISOString();
      isAdmin = false;
      showMainApp();
    }

    // Toggle auth mode
    function toggleAuth() {
      if (isAdmin) return; // Don't allow toggle in admin mode
      
      isLogin = !isLogin;
      document.getElementById('loginTitle').innerText = isLogin ? 'Welcome Back!' : 'Join Wifto!';
      document.getElementById('authButton').innerText = isLogin ? 'Login' : 'Sign Up';
      document.getElementById('authSwitch').innerText = isLogin 
        ? "Don't have an account? Sign up" 
        : "Already have an account? Login";
    }

    // Handle authentication
    function handleAuth() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      
      if (!username || !password) {
        alert("Please enter username and password");
        return;
      }

      if (isAdmin) {
        // Admin login
        if (username === 'admin' && password === '14401312') {
          currentUser = 'Administrator';
          sessionStartTime = new Date().toISOString();
          isAdmin = true;
          
          localStorage.setItem('currentUserSession', JSON.stringify({
            username: currentUser,
            loginTime: sessionStartTime,
            isAdmin: true
          }));
          
          document.getElementById('loginModal').classList.add('hidden');
          showMainApp();
          logActivity('Admin login', 'system');
        } else {
          alert("Invalid admin credentials");
        }
        return;
      }

      if (isLogin) {
        const users = JSON.parse(localStorage.getItem("users")) || {};
        if (users[username] && users[username] === password) {
          currentUser = username;
          sessionStartTime = new Date().toISOString();
          isAdmin = false;
          
          localStorage.setItem('currentUserSession', JSON.stringify({
            username: currentUser,
            loginTime: sessionStartTime,
            isAdmin: false
          }));
          
          document.getElementById('loginModal').classList.add('hidden');
          showMainApp();
          logActivity('User login', username);
        } else {
          alert("Invalid credentials");
        }
      } else {
        let users = JSON.parse(localStorage.getItem("users")) || {};
        if (users[username]) {
          alert("User already exists");
          return;
        }
        users[username] = password;
        localStorage.setItem("users", JSON.stringify(users));
        alert("Signup successful! You can now log in.");
        toggleAuth();
        logActivity('New user registration', username);
      }
    }

    // Show main app
    function showMainApp() {
      document.getElementById('welcomePage').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      document.getElementById('userPanel').classList.remove('hidden');
      
      const userAvatar = document.getElementById('userAvatar');
      const userName = document.getElementById('userName');
      const loginTime = document.getElementById('loginTime');
      
      userAvatar.textContent = currentUser.charAt(0).toUpperCase();
      if (isAdmin) userAvatar.classList.add('admin');
      userName.textContent = currentUser;
      loginTime.textContent = `Login: ${new Date(sessionStartTime).toLocaleTimeString()}`;
      
      // Show/hide admin navigation
      if (isAdmin) {
        document.getElementById('adminNavBar').classList.remove('hidden');
        document.getElementById('navBar').style.display = 'none';
        showAdminSection('adminDash');
      } else {
        document.getElementById('adminNavBar').classList.add('hidden');
        document.getElementById('navBar').style.display = 'flex';
        showMainSection('home');
      }
      
      updateSessionTimer();
      setInterval(updateSessionTimer, 60000);
      
      loadUserData();
      renderNews();
      updateDashboardStats();
    }

    // Show main section
    function showMainSection(sectionName) {
      // Hide all main sections
      document.querySelectorAll('#homeSection, #quizSection, #chatSection, #searchSection').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(sectionName + 'Section').classList.remove('hidden');
      
      // Update navigation
      document.querySelectorAll('.nav-btn:not(.admin)').forEach(btn => btn.classList.remove('active'));
      document.getElementById(sectionName + 'Nav').classList.add('active');
      
      // Section-specific actions
      if (sectionName === 'chat') {
        initializeChat();
      }
    }

    // Show admin section
    function showAdminSection(sectionName) {
      // Hide all admin sections
      document.querySelectorAll('[id^="admin"][id$="Section"]').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(sectionName + 'Section').classList.remove('hidden');
      
      // Update navigation
      document.querySelectorAll('.nav-btn.admin').forEach(btn => btn.classList.remove('active'));
      document.getElementById(sectionName + 'Nav').classList.add('active');
      
      // Section-specific actions
      if (sectionName === 'adminDash') {
        updateDashboardStats();
      } else if (sectionName === 'adminUsers') {
        loadUserManagement();
      }
    }

    // Update session timer
    function updateSessionTimer() {
      if (!sessionStartTime) return;
      const now = new Date();
      const start = new Date(sessionStartTime);
      const minutes = Math.floor((now - start) / (1000 * 60));
      document.getElementById('sessionInfo').textContent = `Session: ${minutes}m`;
    }

    // Logout
    function logout() {
      logActivity('User logout', currentUser);
      localStorage.removeItem('currentUserSession');
      location.reload();
    }

    // Set theme
    function setTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      
      document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(theme + 'Theme').classList.add('active');
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.setAttribute('data-theme', savedTheme);

    // Initialize news data
    function initializeNewsData() {
      const savedNews = JSON.parse(localStorage.getItem('newsData'));
      if (!savedNews || savedNews.length === 0) {
        newsData = [...sampleNewsData];
        localStorage.setItem('newsData', JSON.stringify(newsData));
      } else {
        newsData = savedNews;
      }
    }

    // Render news
    function renderNews(filterData = null) {
      const container = document.getElementById('newsContainer');
      const dataToRender = filterData || newsData;
      
      container.innerHTML = '';
      
      if (dataToRender.length === 0) {
        container.innerHTML = '<div class="loading">No news found üì∞</div>';
        return;
      }
      
      dataToRender.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      dataToRender.forEach(news => {
        const newsCard = document.createElement('div');
        newsCard.className = 'news-card';
        newsCard.innerHTML = `
          <div class="news-header">${news.title}</div>
          <div class="news-content">
            <p class="news-summary">${news.summary}</p>
            <div class="news-tags">
              ${news.tags.map(tag => `<span class="news-tag">${tag}</span>`).join('')}
            </div>
          </div>
          <div class="news-footer">
            <div class="news-actions">
              <button class="action-btn like-btn ${getUserLikedNews().includes(news.id) ? 'liked' : ''}" onclick="toggleLike(${news.id})">
                ‚ù§Ô∏è ${news.likes}
              </button>
              <button class="action-btn share-btn" onclick="shareNews(${news.id})">
                üì§ ${news.shares}
              </button>
            </div>
            <small>${formatTimeAgo(news.timestamp)} ‚Ä¢ ${news.source}</small>
          </div>
        `;
        container.appendChild(newsCard);
      });
    }

    // Toggle like
    function toggleLike(newsId) {
      const userLikes = getUserLikedNews();
      const newsItem = newsData.find(n => n.id === newsId);
      
      if (userLikes.includes(newsId)) {
        // Unlike
        const index = userLikes.indexOf(newsId);
        userLikes.splice(index, 1);
        newsItem.likes--;
      } else {
        // Like
        userLikes.push(newsId);
        newsItem.likes++;
      }
      
      localStorage.setItem(`userLikes_${currentUser}`, JSON.stringify(userLikes));
      localStorage.setItem('newsData', JSON.stringify(newsData));
      renderNews();
      logActivity('News interaction', currentUser);
    }

    // Share news
    function shareNews(newsId) {
      const newsItem = newsData.find(n => n.id === newsId);
      newsItem.shares++;
      
      // Create shareable link (simulated)
      const shareUrl = `${window.location.origin}?shared=${newsId}&guest=true`;
      
      if (navigator.share) {
        navigator.share({
          title: newsItem.title,
          text: newsItem.summary,
          url: shareUrl,
        });
      } else {
        // Fallback
        navigator.clipboard.writeText(shareUrl);
        alert('Share link copied to clipboard!');
      }
      
      localStorage.setItem('newsData', JSON.stringify(newsData));
      renderNews();
      logActivity('News shared', currentUser);
    }

    // Get user liked news
    function getUserLikedNews() {
      return JSON.parse(localStorage.getItem(`userLikes_${currentUser}`)) || [];
    }

    // Format time ago
    function formatTimeAgo(timestamp) {
      const now = new Date();
      const time = new Date(timestamp);
      const diff = now - time;
      const hours = Math.floor(diff / (1000 * 60 * 60));
      
      if (hours < 1) return 'Just now';
      if (hours === 1) return '1 hour ago';
      if (hours < 24) return `${hours} hours ago`;
      
      const days = Math.floor(hours / 24);
      if (days === 1) return '1 day ago';
      return `${days} days ago`;
    }

    // Search news
    function searchNews() {
      const query = document.getElementById('newsSearch').value.trim().toLowerCase();
      if (!query) {
        renderNews();
        return;
      }
      
      const filtered = newsData.filter(news =>
        news.title.toLowerCase().includes(query) ||
        news.summary.toLowerCase().includes(query) ||
        news.tags.some(tag => tag.toLowerCase().includes(query)) ||
        news.category.toLowerCase().includes(query)
      );
      
      renderNews(filtered);
    }

    // Refresh news
    function refreshNews() {
      const container = document.getElementById('newsContainer');
      container.innerHTML = '<div class="loading">Refreshing news... üîÑ</div>';
      
      // Simulate fetching new news
      setTimeout(() => {
        // Add some variation to existing news
        newsData.forEach(news => {
          news.likes += Math.floor(Math.random() * 5);
          news.shares += Math.floor(Math.random() * 3);
        });
        
        // Optionally add a new random news item
        if (Math.random() > 0.5) {
          const newNews = {
            id: Date.now(),
            title: "Breaking: New Scientific Discovery Announced",
            summary: "Researchers have made a significant breakthrough that could change our understanding of the field. More details are being analyzed and will be released soon.",
            category: ["Science", "Technology", "Environment"][Math.floor(Math.random() * 3)],
            tags: ["breaking", "research", "discovery"],
            likes: Math.floor(Math.random() * 20),
            shares: Math.floor(Math.random() * 10),
            timestamp: new Date(),
            source: "Research Institute"
          };
          newsData.unshift(newNews);
        }
        
        localStorage.setItem('newsData', JSON.stringify(newsData));
        renderNews();
      }, 1500);
    }

    // Quiz functions
    function startQuiz() {
      // Generate random questions from different categories
      const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
      quizQuestions = shuffled.slice(0, 10);
      userResponses = {};
      currentQ = 0;
      
      document.getElementById('quizStart').style.display = 'none';
      document.getElementById('quizContent').style.display = 'block';
      
      showQuestion();
    }

    function showQuestion() {
      const container = document.getElementById('quizContent');
      container.innerHTML = '';

      if (currentQ >= quizQuestions.length) {
        showQuizResults();
        return;
      }

      const q = quizQuestions[currentQ];
      const questionDiv = document.createElement('div');
      questionDiv.className = 'question';
      questionDiv.innerHTML = `
        <strong>Q${currentQ + 1}: ${q.q}</strong>
        <div style="font-size: 0.8em; color: var(--primary-blue); margin-top: 5px;">
          Category: ${q.category} | Difficulty: ${q.difficulty}
        </div>
      `;
      container.appendChild(questionDiv);

      const optionsDiv = document.createElement('div');
      optionsDiv.className = 'options';
      q.options.forEach(opt => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="radio" name="q${currentQ}" value="${opt}" required> ${opt}`;
        optionsDiv.appendChild(label);
      });
      container.appendChild(optionsDiv);

      const buttonDiv = document.createElement('div');
      buttonDiv.className = 'button-group';
      const nextBtn = document.createElement('button');
      nextBtn.textContent = currentQ === quizQuestions.length - 1 ? 'Submit Quiz' : 'Next Question';
      nextBtn.onclick = saveAnswer;
      buttonDiv.appendChild(nextBtn);
      container.appendChild(buttonDiv);
    }

    function saveAnswer() {
      const selected = document.querySelector(`input[name="q${currentQ}"]:checked`);
      if (!selected) {
        alert("Please select an answer!");
        return;
      }
      userResponses[`q${currentQ}`] = selected.value;
      currentQ++;
      showQuestion();
    }

    function showQuizResults() {
      const container = document.getElementById('quizContent');
      container.innerHTML = '';

      let score = 0;
      const wrong = [];
      const categories = {};
      
      quizQuestions.forEach((q, index) => {
        if (!categories[q.category]) categories[q.category] = { correct: 0, total: 0 };
        categories[q.category].total++;
        
        if (userResponses[`q${index}`] === q.answer) {
          score++;
          categories[q.category].correct++;
        } else {
          wrong.push({
            question: q.q,
            correct: q.answer,
            chosen: userResponses[`q${index}`],
            category: q.category,
            difficulty: q.difficulty
          });
        }
      });

      const percentage = Math.round((score/quizQuestions.length)*100);
      
      // Save quiz result
      const quizResult = {
        score: score,
        total: quizQuestions.length,
        percentage: percentage,
        date: new Date().toISOString(),
        categories: categories,
        weaknesses: wrong.map(w => w.category)
      };
      
      let quizHistory = JSON.parse(localStorage.getItem(`quizHistory_${currentUser}`)) || [];
      quizHistory.push(quizResult);
      localStorage.setItem(`quizHistory_${currentUser}`, JSON.stringify(quizHistory));

      // Display results
      const scoreBox = document.createElement('div');
      scoreBox.className = 'score-box';
      scoreBox.innerHTML = `
        <h2>üéØ Your Score: ${score} / ${quizQuestions.length}</h2>
        <p>Percentage: ${percentage}%</p>
        <div style="margin-top: 10px;">
          ${percentage >= 80 ? 'üèÜ Excellent!' : percentage >= 60 ? 'üëç Good job!' : 'üìö Keep studying!'}
        </div>
      `;
      container.appendChild(scoreBox);

      // Category analysis
      if (Object.keys(categories).length > 1) {
        const analysisDiv = document.createElement('div');
        analysisDiv.className = 'analysis-card';
        analysisDiv.innerHTML = '<h3>üìä Performance Analysis</h3>';
        
        Object.entries(categories).forEach(([cat, data]) => {
          const catPercentage = Math.round((data.correct / data.total) * 100);
          analysisDiv.innerHTML += `
            <p><strong>${cat}:</strong> ${data.correct}/${data.total} (${catPercentage}%)
            ${catPercentage < 50 ? ' - ‚ö†Ô∏è Needs improvement' : catPercentage >= 80 ? ' - ‚úÖ Strong' : ' - üëå Average'}</p>
          `;
        });
        container.appendChild(analysisDiv);
      }

      // Wrong answers with enhanced feedback
      if (wrong.length > 0) {
        const weaknessDiv = document.createElement('div');
        weaknessDiv.className = 'weakness-analysis';
        weaknessDiv.innerHTML = '<h3>üéØ Areas for Improvement</h3>';
        
        wrong.forEach(item => {
          weaknessDiv.innerHTML += `
            <div style="margin: 15px 0; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 10px;">
              <p><strong>Question:</strong> ${item.question}</p>
              <p>‚ùå Your Answer: <span style="color:red; font-weight:bold;">${item.chosen}</span></p>
              <p>‚úÖ Correct Answer: <span style="color:green; font-weight:bold;">${item.correct}</span></p>
              <p>üìö Category: ${item.category} | Difficulty: ${item.difficulty}</p>
              <button onclick="explainAnswer('${item.category}', '${item.question}')" 
                      style="background: var(--primary-blue); color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; margin-top: 5px;">
                ü§î Why is this correct?
              </button>
            </div>
          `;
        });
        container.appendChild(weaknessDiv);
      }

      // Action buttons
      const buttonDiv = document.createElement('div');
      buttonDiv.className = 'button-group';
      
      const restartBtn = document.createElement('button');
      restartBtn.textContent = 'üîÑ Take Another Quiz';
      restartBtn.onclick = () => {
        document.getElementById('quizContent').style.display = 'none';
        document.getElementById('quizStart').style.display = 'block';
      };
      buttonDiv.appendChild(restartBtn);
      
      if (wrong.length > 0) {
        const studyBtn = document.createElement('button');
        studyBtn.textContent = 'üìö Study Weak Areas';
        studyBtn.onclick = () => createTargetedQuiz(wrong);
        buttonDiv.appendChild(studyBtn);
      }
      
      container.appendChild(buttonDiv);
      
      logActivity('Quiz completed', currentUser);
    }

    // Explain answer
    function explainAnswer(category, question) {
      const explanations = {
        'Geography': 'This relates to physical features and locations on Earth.',
        'Biology': 'This involves living organisms and life processes.',
        'Science': 'This is about scientific principles and discoveries.',
        'Chemistry': 'This deals with chemical elements and reactions.',
        'Physics': 'This involves physical laws and phenomena.',
        'Environment': 'This relates to environmental science and ecology.',
        'Technology': 'This involves technological innovations and applications.',
        'Astronomy': 'This deals with space and celestial objects.'
      };
      
      const explanation = explanations[category] || 'This is an important concept to understand.';
      alert(`üí° ${explanation}\n\nüîç Try searching for more information about "${question.split(' ')[0]} ${category}" to learn more!`);
    }

    // Create targeted quiz
    function createTargetedQuiz(wrongAnswers) {
      const categories = [...new Set(wrongAnswers.map(w => w.category))];
      const targetedQuestions = questionBank.filter(q => categories.includes(q.category));
      
      if (targetedQuestions.length < 5) {
        alert('Not enough questions available for targeted practice. Try the regular quiz instead.');
        return;
      }
      
      quizQuestions = targetedQuestions.sort(() => 0.5 - Math.random()).slice(0, 8);
      userResponses = {};
      currentQ = 0;
      
      const container = document.getElementById('quizContent');
      container.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #fff3e0, #ffe0b2); border-radius: 10px;">
          <h3>üéØ Targeted Practice Quiz</h3>
          <p>Focusing on your weak areas: ${categories.join(', ')}</p>
        </div>
      `;
      
      showQuestion();
    }

    // Chat functions
    function initializeChat() {
      if (chatHistory.length === 0) {
        chatHistory.push({
          type: 'bot',
          message: `Hello ${currentUser}! üòä I'm WiftoBot, your educational companion! I'm here to help you learn about science, technology, and the environment. Ask me anything, and I'll do my best to explain it in an engaging way! What would you like to explore today?`,
          timestamp: new Date()
        });
        renderChatHistory();
      }
    }

    function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      // Add user message
      chatHistory.push({
        type: 'user',
        message: message,
        timestamp: new Date()
      });
      
      input.value = '';
      renderChatHistory();
      
      // Simulate bot typing
      setTimeout(() => {
        const botResponse = generateBotResponse(message);
        chatHistory.push({
          type: 'bot',
          message: botResponse,
          timestamp: new Date()
        });
        renderChatHistory();
        logActivity('Chat interaction', currentUser);
      }, 1500);
    }

    function generateBotResponse(userMessage) {
      const message = userMessage.toLowerCase();
      
      // Emotional responses
      const emotions = ['üòä', 'ü§î', 'üí°', 'üéâ', 'üåü', 'üî¨', 'üåç', '‚ö°'];
      const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
      
      // Knowledge base responses
      if (message.includes('climate') || message.includes('global warming')) {
        return `${randomEmotion} Climate change is indeed a critical issue! It refers to long-term changes in Earth's climate patterns, primarily caused by increased greenhouse gases like CO2. This leads to rising temperatures, melting ice caps, and extreme weather events. Did you know that renewable energy sources like solar and wind can help reduce our carbon footprint? üå± What specific aspect of climate science would you like to explore?`;
      }
      
      if (message.includes('photosynthesis')) {
        return `üå± Photosynthesis is absolutely fascinating! It's how plants convert sunlight, water, and CO2 into glucose and oxygen. The equation is: 6CO2 + 6H2O + sunlight ‚Üí C6H12O6 + 6O2. This process is crucial for life on Earth - it produces the oxygen we breathe and forms the base of most food chains! Plants are basically nature's solar panels! ‚òÄÔ∏è Want to know more about how different plants have adapted this process?`;
      }
      
      if (message.includes('ai') || message.includes('artificial intelligence')) {
        return `ü§ñ AI is revolutionizing our world! As an AI myself, I can tell you it's about creating systems that can perform tasks typically requiring human intelligence. Machine learning, deep learning, and neural networks are key technologies. AI is helping in medicine, climate research, education (like me!), and countless other fields. It's exciting but also raises important ethical questions. What aspect of AI interests you most? üí≠`;
      }
      
      if (message.includes('quantum')) {
        return `‚öõÔ∏è Quantum physics blows my mind too! At the quantum level, particles behave in ways that seem impossible - they can be in multiple states simultaneously (superposition) and instantly affect each other across vast distances (entanglement). Quantum computers use these properties to solve complex problems exponentially faster than classical computers. It's like nature's own magic trick! ‚ú® What quantum concept confuses you the most?`;
      }
      
      if (message.includes('ocean') || message.includes('marine')) {
        return `üåä The oceans are Earth's most mysterious frontiers! Covering 71% of our planet, they regulate climate, produce oxygen, and host incredible biodiversity. From bioluminescent creatures in the deep sea to coral reefs that are underwater rainforests, marine life is amazingly diverse. Ocean acidification and plastic pollution are major concerns though. What marine topic makes you most curious? üê†`;
      }
      
      if (message.includes('space') || message.includes('universe')) {
        return `üöÄ Space absolutely amazes me! The universe is about 13.8 billion years old and contains over 2 trillion galaxies. We're literally made of stardust - the carbon, oxygen, and other elements in our bodies were forged in the hearts of dying stars! Recent discoveries of exoplanets, black hole images, and potential signs of life make space exploration more exciting than ever. What cosmic mystery intrigues you most? ‚≠ê`;
      }
      
      if (message.includes('dna') || message.includes('genetics')) {
        return `üß¨ DNA is life's instruction manual! This double helix contains all the information needed to build and maintain living organisms. It's incredible that just four bases (A, T, G, C) can code for the amazing diversity of life. Gene editing technologies like CRISPR are opening new possibilities in medicine and agriculture, though they also raise ethical questions. Genetics is truly the language of life! What genetic concept fascinates you?`;
      }
      
      if (message.includes('energy') || message.includes('renewable')) {
        return `‚ö° Energy is everywhere around us! From the fusion reactions powering our sun to the chemical energy in our food, understanding energy transformations is key to understanding our world. Renewable energy sources like solar, wind, and hydroelectric power are crucial for a sustainable future. The efficiency improvements in solar panels and wind turbines in recent years have been remarkable! What energy topic energizes you most? üòÑ`;
      }
      
      if (message.includes('hello') || message.includes('hi')) {
        return `${randomEmotion} Hello there! I'm so excited to chat with you about the wonders of science and technology! Whether you're curious about the mysteries of the universe, the complexity of life, or the innovations shaping our future, I'm here to explore these topics together. What's sparking your curiosity today?`;
      }
      
      if (message.includes('help') || message.includes('what can you do')) {
        return `üí° I'm here to be your learning companion! I can help you with:\n\nüî¨ Science concepts (physics, chemistry, biology)\nüåç Environmental topics (climate, ecology, sustainability)\nüíª Technology explanations (AI, computers, innovations)\nüåå Space and astronomy\nüìö Study tips and explanations\nü§î Critical thinking about scientific topics\n\nJust ask me about anything that makes you curious! I love getting into the fascinating details of how our world works. What subject shall we dive into? üèä‚Äç‚ôÇÔ∏è`;
      }
      
      if (message.includes('quiz') || message.includes('test')) {
        return `üéØ Great idea! Taking quizzes is an excellent way to test and reinforce your knowledge! You can access our interactive quiz system from the Quiz section. It adapts to your performance and provides detailed explanations for wrong answers. After each quiz, you'll get personalized insights about your strengths and areas for improvement. Learning is most effective when it's challenging but achievable! Ready to test your knowledge? üìö`;
      }
      
      if (message.includes('thanks') || message.includes('thank you')) {
        return `${randomEmotion} You're so welcome! I genuinely enjoy helping curious minds like yours explore the fascinating world of science and technology. Remember, every question you ask makes you a better learner and thinker. Keep being curious - it's one of humanity's greatest strengths! Feel free to ask me anything else. I'm always here to help! üåü`;
      }
      
      if (message.includes('sad') || message.includes('frustrated')) {
        return `üòî I can sense you might be feeling a bit down about learning. That's completely normal! Science and technology can seem overwhelming sometimes, but remember - every expert was once a beginner. Even Einstein had moments of confusion! üí™ The key is persistence and curiosity. Break complex topics into smaller pieces, celebrate small victories, and remember that making mistakes is how we learn best. You've got this! What specific topic is giving you trouble? Let's tackle it together! ü§ù`;
      }
      
      if (message.includes('excited') || message.includes('amazing')) {
        return `üéâ I love your enthusiasm! That excitement you're feeling? That's the same feeling that drives scientists to make groundbreaking discoveries! Curiosity and wonder are the fuel of scientific progress. When you're excited about learning, your brain actually forms stronger neural connections, making it easier to remember and understand concepts. Keep that passion alive - the world needs more people who find science amazing! What's got you most excited right now? ‚ö°`;
      }
      
      // Default responses with personality
      const defaultResponses = [
        `${randomEmotion} That's a great question! While I'd love to give you a detailed answer, I think this topic deserves some deeper exploration. Try searching for more information or asking me to explain a specific scientific concept. I'm particularly good at explaining complex topics in simple terms! What aspect interests you most?`,
        
        `ü§î Hmm, that's an interesting topic! I might not have all the details on that specific subject, but I'm great at explaining scientific principles, environmental concepts, and technology topics. Is there a particular science or tech concept you'd like me to break down for you?`,
        
        `üí° I appreciate your curiosity! While I might not have expertise in that exact area, I'm passionate about helping you understand the scientific world around us. Try asking me about physics, chemistry, biology, climate science, or technology - those are my strong suits! What scientific mystery can I help solve for you?`,
        
        `üåü You know, that's exactly the kind of question that makes learning exciting! Even if I don't have all the answers, the fact that you're asking shows great scientific thinking. Why don't you try rephrasing your question around a specific scientific concept? I love explaining how things work in nature and technology!`
      ];
      
      return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
    }

    function renderChatHistory() {
      const messagesContainer = document.getElementById('chatMessages');
      messagesContainer.innerHTML = '';
      
      chatHistory.forEach(chat => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${chat.type}`;
        messageDiv.textContent = chat.message;
        messagesContainer.appendChild(messageDiv);
      });
      
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Search functions
    function performSearch() {
      const query = document.getElementById('searchInput').value.trim();
      if (!query) {
        alert("Please enter a search term");
        return;
      }
      
      const resultsContainer = document.getElementById('searchResults');
      resultsContainer.innerHTML = '<div class="loading">Searching for educational content... üîç</div>';
      
      // Simulate search
      setTimeout(() => {
        const mockResults = generateMockSearchResults(query);
        renderSearchResults(mockResults, query);
        logActivity('Search performed', currentUser);
      }, 1500);
    }

    function generateMockSearchResults(query) {
      const searchResults = [
        {
          title: `Understanding ${query} - Complete Guide`,
          summary: `A comprehensive overview of ${query} covering fundamental concepts, recent developments, and practical applications. This resource provides in-depth explanations suitable for students and professionals.`,
          type: 'Educational Resource',
          source: 'Science Education Portal',
          relevance: 95
        },
        {
          title: `${query} in Modern Technology`,
          summary: `Explore how ${query} is revolutionizing various industries and technological applications. Learn about cutting-edge research and future implications.`,
          type: 'Technology Article',
          source: 'Tech Research Institute',
          relevance: 88
        },
        {
          title: `Environmental Impact of ${query}`,
          summary: `Analyzing the environmental implications and sustainability aspects of ${query}. Includes case studies and expert opinions on ecological effects.`,
          type: 'Environmental Study',
          source: 'Green Science Journal',
          relevance: 82
        },
        {
          title: `Latest Research on ${query}`,
          summary: `Recent scientific studies and breakthroughs related to ${query}. Featuring peer-reviewed research and expert commentary on emerging trends.`,
          type: 'Research Paper',
          source: 'Academic Database',
          relevance: 90
        }
      ];
      
      return searchResults.sort((a, b) => b.relevance - a.relevance);
    }

    function renderSearchResults(results, query) {
      const container = document.getElementById('searchResults');
      
      if (results.length === 0) {
        container.innerHTML = '<div class="error">No results found. Try different keywords.</div>';
        return;
      }
      
      container.innerHTML = `
        <div style="margin-bottom: 20px; padding: 15px; background: var(--card-bg); border-radius: 10px; border-left: 4px solid var(--primary-blue);">
          <h3>üîç Search Results for "${query}"</h3>
          <p>Found ${results.length} relevant educational resources</p>
        </div>
      `;
      
      results.forEach(result => {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'news-card';
        resultDiv.style.marginBottom = '15px';
        resultDiv.innerHTML = `
          <div class="news-header">${result.title}</div>
          <div class="news-content">
            <p class="news-summary">${result.summary}</p>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
              <div class="news-tags">
                <span class="news-tag">${result.type}</span>
                <span class="news-tag">${result.relevance}% relevant</span>
              </div>
              <small style="color: var(--primary-blue);">${result.source}</small>
            </div>
          </div>
        `;
        container.appendChild(resultDiv);
      });
    }

    // Admin functions
    function updateDashboardStats() {
      if (!isAdmin) return;
      
      const users = JSON.parse(localStorage.getItem('users')) || {};
      const totalUsers = Object.keys(users).length + 1; // +1 for guest users
      
      let totalQuizzes = 0;
      let totalScore = 0;
      let quizCount = 0;
      
      Object.keys(users).forEach(username => {
        const quizHistory = JSON.parse(localStorage.getItem(`quizHistory_${username}`)) || [];
        totalQuizzes += quizHistory.length;
        quizHistory.forEach(quiz => {
          totalScore += quiz.percentage;
          quizCount++;
        });
      });
      
      const avgScore = quizCount > 0 ? Math.round(totalScore / quizCount) : 0;
      const totalContent = newsData.length;
      
      document.getElementById('totalUsers').textContent = totalUsers;
      document.getElementById('totalQuizzes').textContent = totalQuizzes;
      document.getElementById('totalContent').textContent = totalContent;
      document.getElementById('avgScore').textContent = avgScore + '%';
      document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
      
      updateRecentActivity();
      updateTopPerformers();
    }

    function updateRecentActivity() {
      const activities = JSON.parse(localStorage.getItem('activityLog')) || [];
      const recent = activities.slice(-5).reverse();
      
      const container = document.getElementById('recentActivity');
      container.innerHTML = recent.map(activity => 
        `<p><strong>${activity.action}</strong><br>
         <small>${activity.user} - ${new Date(activity.timestamp).toLocaleString()}</small></p>`
      ).join('') || '<p>No recent activity</p>';
    }

    function updateTopPerformers() {
      const users = JSON.parse(localStorage.getItem('users')) || {};
      const performers = [];
      
      Object.keys(users).forEach(username => {
        const quizHistory = JSON.parse(localStorage.getItem(`quizHistory_${username}`)) || [];
        if (quizHistory.length > 0) {
          const avgScore = quizHistory.reduce((sum, quiz) => sum + quiz.percentage, 0) / quizHistory.length;
          performers.push({ username, avgScore: Math.round(avgScore), quizCount: quizHistory.length });
        }
      });
      
      performers.sort((a, b) => b.avgScore - a.avgScore);
      const top5 = performers.slice(0, 5);
      
      const container = document.getElementById('topPerformers');
      container.innerHTML = top5.map((performer, index) => 
        `<p><strong>#${index + 1} ${performer.username}</strong><br>
         <small>Avg: ${performer.avgScore}% (${performer.quizCount} quizzes)</small></p>`
      ).join('') || '<p>No performance data available</p>';
    }

    function loadUserManagement() {
      const users = JSON.parse(localStorage.getItem('users')) || {};
      const container = document.getElementById('usersList');
      
      container.innerHTML = '<h3>Registered Users</h3>';
      
      if (Object.keys(users).length === 0) {
        container.innerHTML += '<p>No registered users yet.</p>';
        return;
      }
      
      Object.keys(users).forEach(username => {
        const userData = JSON.parse(localStorage.getItem(`userData_${username}`)) || {};
        const quizHistory = JSON.parse(localStorage.getItem(`quizHistory_${username}`)) || [];
        const lastLogin = userData.lastLogin ? new Date(userData.lastLogin).toLocaleDateString() : 'Never';
        
        const userDiv = document.createElement('div');
        userDiv.className = 'admin-card';
        userDiv.innerHTML = `
          <h4>üë§ ${username}</h4>
          <p>Last Login: ${lastLogin}</p>
          <p>Quizzes Taken: ${quizHistory.length}</p>
          <p>Files Uploaded: ${(userData.files || []).length}</p>
          <div class="button-group">
            <button onclick="viewUserDetail('${username}')">üëÅÔ∏è View Details</button>
            <button onclick="resetUser('${username}')" style="background: #e53935;">üóëÔ∏è Reset User</button>
          </div>
        `;
        container.appendChild(userDiv);
      });
    }

    function viewUserDetail(username) {
      const quizHistory = JSON.parse(localStorage.getItem(`quizHistory_${username}`)) || [];
      const userData = JSON.parse(localStorage.getItem(`userData_${username}`)) || {};
      
      let detail = `User Details: ${username}\n\n`;
      detail += `Quiz History: ${quizHistory.length} quizzes\n`;
      if (quizHistory.length > 0) {
        const avgScore = quizHistory.reduce((sum, quiz) => sum + quiz.percentage, 0) / quizHistory.length;
        detail += `Average Score: ${Math.round(avgScore)}%\n`;
      }
      detail += `Files Uploaded: ${(userData.files || []).length}\n`;
      detail += `Account Created: ${userData.lastLogin ? new Date(userData.lastLogin).toLocaleDateString() : 'Unknown'}`;
      
      alert(detail);
    }

    function resetUser(username) {
      if (confirm(`Are you sure you want to reset all data for ${username}? This action cannot be undone.`)) {
        localStorage.removeItem(`userData_${username}`);
        localStorage.removeItem(`quizHistory_${username}`);
        localStorage.removeItem(`userLikes_${username}`);
        
        alert(`User ${username} has been reset.`);
        loadUserManagement();
        logActivity('User reset by admin', username);
      }
    }

    function addCustomNews() {
      const title = prompt('Enter news title:');
      if (!title) return;
      
      const summary = prompt('Enter news summary:');
      if (!summary) return;
      
      const category = prompt('Enter category (Science/Technology/Environment):') || 'General';
      const tags = (prompt('Enter tags (comma-separated):') || '').split(',').map(tag => tag.trim()).filter(tag => tag);
      
      const newNews = {
        id: Date.now(),
        title: title,
        summary: summary,
        category: category,
        tags: tags,
        likes: 0,
        shares: 0,
        timestamp: new Date(),
        source: 'Admin'
      };
      
      newsData.unshift(newNews);
      localStorage.setItem('newsData', JSON.stringify(newsData));
      renderNews();
      
      alert('News added successfully!');
      logActivity('News added by admin', 'Administrator');
    }

    function resetAllData() {
      if (confirm('Are you sure you want to reset ALL platform data? This will delete all users, quizzes, and content. This action cannot be undone!')) {
        if (confirm('This is your final confirmation. All data will be permanently deleted. Continue?')) {
          // Clear all localStorage
          const keys = Object.keys(localStorage);
          keys.forEach(key => {
            if (key !== 'theme') { // Keep theme preference
              localStorage.removeItem(key);
            }
          });
          
          alert('All data has been reset. The page will reload.');
          location.reload();
        }
      }
    }

    function backupData() {
      const backup = {
        users: localStorage.getItem('users'),
        newsData: localStorage.getItem('newsData'),
        activityLog: localStorage.getItem('activityLog'),
        timestamp: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(backup, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `wifto-backup-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      logActivity('Data backup created', 'Administrator');
    }

    function exportAnalytics() {
      const users = JSON.parse(localStorage.getItem('users')) || {};
      const analytics = {
        totalUsers: Object.keys(users).length,
        userQuizData: {},
        newsData: newsData.length,
        activityLog: JSON.parse(localStorage.getItem('activityLog')) || []
      };
      
      Object.keys(users).forEach(username => {
        const quizHistory = JSON.parse(localStorage.getItem(`quizHistory_${username}`)) || [];
        analytics.userQuizData[username] = {
          totalQuizzes: quizHistory.length,
          averageScore: quizHistory.length > 0 ? 
            Math.round(quizHistory.reduce((sum, quiz) => sum + quiz.percentage, 0) / quizHistory.length) : 0,
          lastQuiz: quizHistory.length > 0 ? quizHistory[quizHistory.length - 1].date : null
        };
      });
      
      const dataStr = JSON.stringify(analytics, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `wifto-analytics-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      logActivity('Analytics exported', 'Administrator');
    }

    // Utility functions
    function logActivity(action, user) {
      const activities = JSON.parse(localStorage.getItem('activityLog')) || [];
      activities.push({
        action,
        user,
        timestamp: new Date().toISOString()
      });
      
      // Keep only last 100 activities
      if (activities.length > 100) {
        activities.splice(0, activities.length - 100);
      }
      
      localStorage.setItem('activityLog', JSON.stringify(activities));
    }

    function loadUserData() {
      if (currentUser === 'Guest' || isAdmin) return;
      
      const userData = JSON.parse(localStorage.getItem(`userData_${currentUser}`)) || {
        files: [],
        quizHistory: [],
        preferences: {}
      };
      
      userFiles = userData.files || [];
    }

    function saveUserData() {
      if (currentUser === 'Guest' || isAdmin) return;
      
      const userData = {
        files: userFiles,
        quizHistory: JSON.parse(localStorage.getItem(`quizHistory_${currentUser}`)) || [],
        preferences: {},
        lastLogin: sessionStartTime
      };
      
      localStorage.setItem(`userData_${currentUser}`, JSON.stringify(userData));
    }

    function viewQuizHistory() {
      const history = JSON.parse(localStorage.getItem(`quizHistory_${currentUser}`)) || [];
      if (history.length === 0) {
        alert("No quiz history found!");
        return;
      }
      
      let historyHtml = '<div class="section"><h3>üìä Your Quiz History</h3>';
      history.forEach((result, index) => {
        const date = new Date(result.date).toLocaleDateString();
        const badge = result.percentage >= 80 ? 'üèÜ' : result.percentage >= 60 ? 'ü•â' : 'üìö';
        historyHtml += `
          <div class="feedback">
            <p><strong>${badge} Quiz ${index + 1}</strong> - ${date}</p>
            <p>Score: ${result.score}/${result.total} (${result.percentage}%)</p>
            ${result.categories ? '<p>Categories: ' + Object.keys(result.categories).join(', ') + '</p>' : ''}
          </div>
        `;
      });
      historyHtml += '</div>';
      
      const container = document.getElementById('quizContent');
      container.innerHTML = historyHtml;
      container.style.display = 'block';
      document.getElementById('quizStart').style.display = 'none';
    }

    function showCustomQuiz() {
      alert('Custom Quiz feature coming soon! You can create quizzes based on specific categories and difficulty levels.');
    }

    function showAdvancedSearch() {
      alert('Advanced Search feature coming soon! You\'ll be able to filter by content type, difficulty, and subject area.');
    }

    // Auto-save user data
    setInterval(() => {
      if (currentUser && currentUser !== 'Guest' && !isAdmin) {
        saveUserData();
      }
    }, 30000);

    // Load saved theme on startup
    setTimeout(() => {
      setTheme(savedTheme);
    }, 100);

  </script>
</body>
</html>